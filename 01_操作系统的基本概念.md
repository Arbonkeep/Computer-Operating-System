# 操作系统基本概念
    1.概念
        * 计算机系统的层次结构        
            从低到高：裸机，操作系统，应用程序，用户
        * 定义：
            操作系统是指控制和管理整个计算机系统的硬件和软件资源，并合理的组织调度计算机的工作和资源的分配，
            以提供用户和其他软件方便的接口和和环境，它是计算机系统中最基本的系统软件。
        * 注意：打开任务管理器快捷键：ctrl + alt + del + 选择 / ctrl + shift +esc

    2. 功能和目标
        * 作为系统资源的管理者：
            * 功能：
                1. 处理机管理：如QQ程序的正常运行，对应的进程需要被处理机(CPU)处理
                2. 存储器管理：如运行QQ程序时，需要将该程序相关的数据加载进内存
                3. 文件管理：如在文件夹中找到相应的可执行性程序的位置
                4. 设备管理：如QQ视频聊天时，需要将摄像头分配给进程
            * 目标：安全和高效

        * 作为用户和计算机硬件之间的接口：
            * 功能：
                1. 命令接口：允许用户直接使用
                    * 联机命令接口：用户说一句，系统做一句
                    * 脱机命令接口：用户说一堆，系统做一堆
                2. 程序接口：允许用户通过程序间接使用，由一种系统调用组成，可以理解为系统调用等于程序接口
                3. GUI: 现代操作系统中最流行的图形用户接口

            * 目标：方便用户直接使用

        * 作为最接近硬件的层次
            * 功能：实现对硬件机器的扩展。
                例如：通过对裸机安装操作系统，可以将裸机改造成更加方便，功能更加强大的机器。

    3. 操作系统的四个基本特征
        1. 并发：
            * 概念：指两个或多个事件在同一时间间隔内发生。这些事件在宏观上是同时发生的，但是在微观上是交替
                    发生的。
                    
                    并行：两个或多个事件在同一时刻同时发生。
                 
                    理解：并行是指在同一时刻，同时做多件事情，而并发就是指在宏观上是同时进行，微观上是交替进行
                          也就是说并发是在很短的时间内交替做事。

            * 操作系统的并发性是指计算机系统中同时存在着多个运行的程序。
            
            * 对于并发的举例：
                单核的计算机同时只能运行一个程序，而操作系统会协调多个程序交替执行。也就是说，微观上是交替进行
                的，但人们在宏观上看来是程序在同时进行。

        2. 共享
            * 概念：
                共享即资源共享，是指在系统中的资源可以共内存中对个并发执行的进程来共同使用
            
            * 分类：
                * 互斥共享方式：虽然系统中的资源可以给多个进程使用，但是，在一个时间内只能给一个进程访问该资源
                    举例:在使用QQ和微信视频聊天时，同一时间内，摄像头只能分配给其中一个使用

                * 同时共享方式：访问资源时，允许一个时间段内多个进程“同时”对资源进行访问
                    举例：在使用QQ发送文件A时，又使用微信发送文件B，在宏观上看，两个资源在同时发送，微观上看
                          两个进程是交替访问硬盘资源发送数据的
            
            * 并发和共享的关系
                * 举例：
                    QQ在发送文件A，微信在发送文件B
                        1. 两个进程在并发的执行（并发性）
                        2. 发送资源需要共享的访问硬盘资源（共享性）
                * 结论：
                    并发性和共享性是互为存在条件的。如果失去了并发性，那么就是一个程序在执行，共享性就没有存在的意义
                    如果失去了共享性，两个进程就不能同时访问硬盘资源，也就不能同时发送文件，也就无法并发。

        3. 虚拟
            * 概念：
                是指把一个物理上的实体变为若干个逻辑上的对应物。物理实体是实际存在的，而逻辑上的对应物是用户感受到的
                举例：
                    单核的CPU同时能执行多个应用程序，为什么呢？为什么只有4G的内存却可以运行超过4G的进程？
                    这是因为前者采用了虚拟处理器技术，实际上只有一个CPU，但是看起有多个程序在执行。后者采用虚拟存储技术。

            * 虚拟技术的分类
                * 空分复用技术（如虚拟存储技术）
                * 时分复用技术（如虚拟处理技术）
                    对于虚拟处理技术而言，如果失去了并发性，那么在一段时间内只需要运行一个程序，实现虚拟性也就没有意义。
                    也就是说，没有并发性就谈不上个虚拟性

        4. 异步
            * 概念：在多道程序运行环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的，而是走走停停，
                    以不可预知的速度向前推进，这就是程序的异步性。

                    举例：
                        当一个进程A需要使用某个指定的资源时，另外一个进程也B需要使用，那么B就需要等到A使用完之后，才能
                        够给B使用。(也就是指走走停停)

    4. 操作系统的发展与分类
        1. 手工操作阶段
            * 主要缺点：用户独占全机，人机速度矛盾导致资源利用率极低
        
        2. 批处理阶段：单道批处理阶段
            * 引入脱机输入/输出技术(用磁带完成)，并监督程序负责控制作业的输入输出
            * 主要优点：缓解一定程度的人机速度矛盾，资源利用率有所提升。
            * 主要缺点：内存中仅能有一道程序运行，只有该程序运行结束之后才能调入下一道程序。CPU有大量的时间是在空闲等待
                        i/o完成资源利用率依然很低
    
        3. 批处理阶段：多道批处理系统
            * 主要优点：多道程序并发执行，能够共享计算机资源。资源利用率大幅度提升，CPU和其他资源保持忙碌状态，系统吞吐
                        量增大
            * 主要缺点：用户响应时间过长，没有人机交互的功能（用户提交自己的作业之后就只能等待计算机处理完成，中间不能
                        控制自己的作业执行）

        4. 分时操作系统
            * 概念：计算机以时间片为单位轮流为各个用户/作业服务，各个用户可以通过终端与计算机进行交互
            * 主要优点：用户请求可以被即时响应，解决了人机交互问题。允许多个用户同时使用一台计算机，并且用户对计算机的
                        操作相互独立，感受不到对方的存在
            * 主要缺点：不能优先处理一些紧急任务，操作系统对各个用户/作业都是完全公平的，循环地为每个用户/作业服务一个时
                        间片，不区分任务的紧急性

        5. 实时操作系统（需要在严格的时限内处理完时间）
            * 主要优点：能够优先响应一些紧急任务，某些紧急任务不需要时间片排对
            * 主要特点：及时性和可靠性
            * 分类
                1. 硬实施系统：不许在绝对严格的规定时间内完成处理。如：导弹控制系统，自动驾驶系统
                2. 软实时系统：能接受偶尔违反时间规定，如：12306的火车订票系统

        6. 其他几种操作系统
            1. 网络操作系统：是伴随者计算机网络的发展而诞生的，把网络中各个计算机有机的结合起来，实现数据传输等功能，实现
                            网络中各种资源的共享（如文件共享）和各台计算机之间的通信。（如：Windows NT就是一种典型的网络
                            操作系统，网站服务器就可以使用）

            2. 分布式操作系统：
                * 主要特点：分布性，并行性
                各台计算机的地位相同，任何工作都可以分布在这些计算机上，由他们并行，协同完成这个任务

            3. 个人计算机操作系统
                如：Windows XP MacOS 等
    
    5. 操作系统的运行机制和体系结构
        1. 运行机制
            * 指令：就是指处理器(CPU)能识别，执行的最基本命令
                * 指令的分类（两种）：
                    1. 特权指令：不允许用户程序使用的指令（如内存清零指令）
                    2. 非特权指令：用户程序能使用的指令（如普通的运算指令）
                
                * 问题：CPU如何判断当前是否可以执行特权指令？通过处理器状态实现
                        * 两种处理器状态：
                            1. 用户态（目态）：此时CPU只能执行非特权指令
                            2. 核心态（管态）：特权指令和非特权指令都能执行
                            注意：处理器状态是用程序状态字寄存器（PSW）中的某标志位来标识当前处理器处于什么状态。如0为用户
                                 态，1为核心态
        
                * 两种程序：
                    1. 内核程序：操作系统的内核程序时系统的管理者，既可以执行特权指令，也可以执行非特权指令，运行在核心态
                    2. 应用程序：为了保证系统的安全运行，应用程序只能使用非特权指令，运行在用户态
            
        2. 操作系统的内核
            * 概念：内核是计算机上配置的底层软件，试操作系统中最基本，最核心的部分
                    如：进程管理，存储器管理，设备管理等功能，以及时钟管理，中断处理，原语（设备驱动，CPU切换等）
                
            * 分类 
                * 原语：是一种特殊的应用程序，处于系统最底层，最接近硬件的部分，这种程序在运行中具有原子性（运
                        行只能一气呵成，不能被中断）特点是运行时间较短，调用频繁

                * 时钟管理：实现计时功能

                * 中断处理：负责实现中断机制

                * 对系统资源进行管理的功能：进程管理，存储器管理，设备管理
            
            * 内核程序：实现操作系统内核功能的程序

        3. 操作系统的体系结构
            * 大内核：将操作系统的主要功能模块都作为系统内核，运行在核心态
                * 优点：高性能
                * 缺点：内核代码庞大，结构混乱，难以维护

            * 微内核：只把最基本的功能保留在内核
                * 优点：内核功能少，结构清晰，方便维护
                * 缺点：需啊哟频繁地在核心态和用户态之间切换，性能低

    6. 中断和异常
        1. 中断机制的诞生
            * 诞生：为了解决计算机运行效率低的问题，人们发明了操作系统（作为计算机的管理者），引入中断机制，实现多道程序并发执行
            * 本质：发生中断之后就意味着需要操作系统介入，开展管理工作

        2. 中断的概念何作用
            1. 当中断发生时，CPU立即进入核心态
            2. 当中断发生后，当前运行的进程暂停运行，并由操作系统内核对中断进行处理。
            3. 对于不同的中断信号，会进行不同的处理

            发生了中断，那么，计算机操作系统就需要介入，开展管理工作，由于操作系统的管理工作需要使用特权指令，因此CPU需要从用户
            态转换为核心态，使操作系统获得计算机的控制权。有了中断，才能实现多道程序的并发执行

            * 问题：如何实现用户态和核心态之间的切换？
                    用户态转换为核心态是通过中断实现的，并且中断是实现两者切换的唯一途径
                    核心态转换为用户态是通过执行一个特权指令，将程序状态字（PSW）的标志位设置为“用户态”
        
        3. 中断的分类
            * 内中断（也称异常，例外，陷入）：信号来源于CPU内部与当前的指令有关
                * 第一种分类方式
                    1. 自愿中断（指令中断）：如：系统调用时使用的访管指令（又叫陷入指令，trap指令）
                    2. 强迫中断
                        * 硬件故障：如缺页
                        * 软件中断：如整数除以0
                * 第二种分类方式
                    1. 陷阱，陷入（trap）：有意而为之的异常。如系统调用
                    2. 故障（fault）：由错误条件引起的，可能被故障处理工具修复。如缺页
                    3. 终止（abort）不可恢复的致命错误造成的结果，终止处理程序不在将控制返回给引发终止的应用程序、如整数除0

            * 外中断（中断）：信号来源于CPU外部，与当前执行的指令无关（狭义上的中断）
                1. 外设请求
                2. 人工干预
        
            * 外中断的处理过程
                1. 执行完每个指令，CPU会检查是否有外部中断信号
                2. 如果有，就需要保护中断的CPU环境（如程序状态字PSW，程序计数器PC，各种通用寄存器）
                3. 根据中断信号转入相应的中断处理程序
                4. 恢复进程的CPU环境并退出中断，返回原进程继续往下执行指令



































